"use strict";const n=require("../common/vendor.js");function s(a){a.config.globalProperties._get=function(i,t,g,o,d){t=t||{},t.token=n.index.getStorageSync("token")||"",t.app_id=this.getAppId(),n.index.request({url:this.websiteUrl+"/index.php/api/"+i,data:t,dataType:"json",method:"GET",header:{appId:this.getAppId()},success:e=>{if(e.statusCode!==200||typeof e.data!="object")return!1;if(e.data.code===-2)this.showError(e.data.msg,function(){n.index.removeStorageSync("token")});else if(e.data.code===-1)console.log("登录态失效, 重新登录"),this.doLogin();else{if(e.data.code===0)return this.showError(e.data.msg,function(){o&&o(e)}),!1;g&&g(e.data)}},fail:e=>{o&&o(e)},complete:e=>{n.index.hideLoading(),d&&d(e)}})},a.config.globalProperties._post=function(i,t,g,o,d){t=t||{},t.token=n.index.getStorageSync("token")||"",t.app_id=this.getAppId(),n.index.request({url:this.websiteUrl+"/index.php/api/"+i,data:t,dataType:"json",method:"POST",header:{"content-type":"application/x-www-form-urlencoded",appId:this.getAppId()},success:e=>{if(e.statusCode!==200||typeof e.data!="object")return!1;if(e.data.code===-1)console.log("登录态失效, 重新登录"),this.doLogin();else{if(e.data.code===0)return this.showError(e.data.msg,function(){o&&o(e)}),!1;g&&g(e.data)}},fail:e=>{o&&o(e)},complete:e=>{n.index.hideLoading(),d&&d(e)}})},a.config.globalProperties.doLogin=function(){let i=getCurrentPages();if(i.length){let t=i[i.length-1];t.route!="pages/login/login"&&t.route!="pages/login/weblogin"&&t.route!="pages/login/openlogin"&&(n.index.setStorageSync("currentPage",t.route),n.index.setStorageSync("currentPageOptions",t.$page.options))}console.log("app_ID="+this.getAppId()),this.gotoPage("/pages/login/login")}}exports.requestFun=s;
