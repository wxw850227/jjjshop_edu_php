"use strict";const e=require("../../common/vendor.js"),g=require("../../common/utils.js"),p=()=>"../../components/app-share.js",h=()=>"../../components/concatMask.js",f=()=>"../knowledge/course/part/share.js",_=()=>"../../components/empty.js",m=()=>"./part/comment.js",v={components:{AppShare:p,concatMask:h,share:f,comment:m,empty:_},data(){return{tabList:[{key:"详情",value:0},{key:"课表",value:1},{key:"评价",value:2}],videoContext:null,phoneHeight:0,scrollviewHigh:0,loadding:!0,indicatorDots:!0,autoplay:!1,interval:6e3,duration:500,isPopup:!1,isPassword:!1,isPay:!1,course_id:null,detail:{sectionNum:0,buyCount:0,title:"",commentCount:0,browse_count:0,banner:[]},isAppShare:!1,isbottmpanel:!1,appParams:{share_type:0,title:"",summary:"",path:"",image:""},isVideoPlay:!1,is_fav:!1,activeName:0,comment_list:[],room_id:0,item:null,ios_login:"20",platform:"",videoAutoplay:!0,shareloading:!1}},onReady(){this.videoContext=e.index.createVideoContext("myVideo"),e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F5F5F5"})},onHide(){this.videoPause()},onLoad(t){let l=g.utils.getSceneData(t);t.room_id&&(this.room_id=t.room_id),this.course_id=t.course_id?t.course_id:l.gid},mounted(){this.init(),this.getData(),this.getList()},methods:{gotoLive(t){let l;if(this.detail.is_pay==1&&this.detail.payStatus==0){e.index.showToast({icon:"none",title:"未购买，请先购买再观看"});return}if(t.status==0){e.index.showToast({icon:"none",title:"直播暂未开始！！！"});return}else t.status==1?l=t.video_link:t.status==2&&(l=t.back_link);this.gotoPage(`/pages/common/webview?url=${l}`)},getConcat(){this.$refs.concatRef.openShow(this.detail)},getToConcat(){let t=this,l={course_id:t.course_id,pay_source:t.getPlatform()};t._post("course.Order/eduBuy",l,function(s){t.$refs.concatRef.openShow(t.detail)})},returnHome(){e.index.switchTab({url:"/pages/index/index"})},changTab(t){this.activeName=t.value,this.activeName==2&&this.$nextTick(()=>{this.$refs.commentRef.getData(this.course_id)})},gotoLast(){let t=this,s=(e.index.getStorageSync("courseLast")||{})[t.course_id];console.log(s),s&&t.gotoPage("/pages/knowledge/course/section-detail?section_id="+s+"&course_id="+t.course_id)},dowloadPDF(t,l){let s=this;e.index.showLoading({title:"加载中"}),e.index.downloadFile({url:t,success:function(a){if(console.log(a),a.statusCode==200){var i=a.tempFilePath;e.index.saveFile({tempFilePath:i,success:function(n){var o=n.savedFilePath;s.fSetFileName(o,l,t)},fail:n=>{e.index.showToast({title:"保存文件失败请重试",icon:"none"})}})}else e.index.showToast({title:"打开文件失败请重试",icon:"none"});e.index.hideLoading()},fail:a=>{e.index.hideLoading(),e.index.showToast({title:"加载失败请重试",icon:"none"})}})},fSetFileName(t,a,s){var a=a.split("/")[a.split("/").length-1],i=t.split("/").splice(0,t.split("/").length-1),n=s;let o=plus.downloader.createDownload(n,{filename:"file://"+i.join("/")+"/"+a},(r,c)=>{if(c==200){let d=plus.io.convertLocalFileSystemURL(r.filename);this.fGetSavedFileList(),e.index.openDocument({filePath:d,fail:u=>{e.index.showToast({title:"打开失败"+u})}})}else plus.downloader.clear()});o.setRequestHeader("Authorization","Bearer "+e.index.getStorageSync("SET_TOKEN")),o.start()},fGetSavedFileList(){e.index.getSavedFileList({success:t=>{t.fileList.forEach(l=>{let s=l.filePath.split("/"),a=s[s.length-1].split(".")[0];parseFloat(a).toString()=="NaN"?console.log(t.fileList):plus.io.resolveLocalFileSystemURL(l.filePath,i=>{i.remove(n=>{plus.console.log("Remove succeeded")},n=>{alert(n.message)})})})}})},MoveTo(t,l){let s=t.split("/"),a=s.reverse()[0];s=s.reverse(),s=s.slice(0,-1);let i=s.join("/")+"/";console.log(a),console.log(i);let n=l;plus.io.resolveLocalFileSystemURL(i+a,function(o){o.moveTo({fullPath:i},n,function(r){e.index.showToast({title:"保存成功",icon:"none"})},function(r){e.index.showToast({title:"文件保存失败或者文件已存在",icon:"none"})})},function(o){console.log("失败"),console.log(o)})},getimg(){return this.detail.banner&&this.detail.banner.length>0?this.detail.banner[0].file_path:""},videoPause(){this.videoContext.pause()},openMaservice(){this.gotoPage("/pages/user/qa/index")},submit(){this.isPopup=!0},closeBuy(t){t=="pay"&&(this.isPay=!0),t=="password"&&(this.isPassword=!0),this.isPopup=!1},closePassword(t){let l=this;if(t){let s=e.index.getStorageSync("coursePss")||{};s[l.course_id]=t,e.index.setStorageSync("coursePss",s),l.gotoPage("/pages/knowledge/course/section-detail?section_id="+l.section_id+"&course_id="+l.course_id)}this.isPassword=!1},closeCashier(t){t&&(this.getData(),this.getList()),this.isPay=!1},init(){let t=this;e.index.getSystemInfo({success(l){t.phoneHeight=l.windowHeight,e.index.createSelectorQuery().select(".btns-wrap").boundingClientRect(a=>{let i=t.phoneHeight-a.height;t.scrollviewHigh=i}).exec()}})},getList(){let t=this,l=t.course_id;e.index.showLoading({title:"加载中"}),t._get("course.comment/list",{course_id:l},function(s){t.comment_list=s.data.list.data,t.loadding=!1,e.index.hideLoading()})},getData(){let t=this,l=t.course_id;e.index.showLoading({title:"加载中"}),t._get("course.course/detail",{course_id:l},function(s){t.ios_login=s.data.ios_login,t.detail=s.data.detail,t.is_fav=s.data.detail.isFav,t.loadding=!1,e.index.hideLoading()})},lookEvaluate(t){this.gotoPage("/pages/product/detail/look-evaluate/look-evaluate?course_id="+t)},goback(){getCurrentPages().length<=1?e.index.switchTab({url:"/pages/index/index"}):e.index.navigateBack()},changeSwiper(){this.isVideoPlay=!1},toLogin(){let t=this;e.index.showActionSheet({title:"开通账号,可享受平台会员权益,游客身份仅对当前设备有效",itemList:["登录账号(推荐)","继续以游客身份操作"],success:function(l){l.tapIndex==0?t.gotoPage("/pages/login/openlogin"):t.visitorLogin()},fail:function(l){console.log(l.errMsg)}})},visitorLogin(){let t=this,l=plus.device.uuid;t._post("user.useropen/visitLogin",{UUID:l},function(s){console.log(s),e.index.setStorageSync("token",s.data.token),e.index.setStorageSync("user_id",s.data.user_id),t.toPay()},s=>{console.log(s)})},toPay(){let t=this;if(t.platform=e.index.getSystemInfoSync().platform,t.ios_login=="10"&&t.platform=="ios"&&!e.index.getStorageSync("token")){t.toLogin();return}t.gotoPage(`/pages/order/confirm?course_id=${t.course_id}&type=eduadmin`)},showShare(){let t=this;t.isbottmpanel=!0},closeBottmpanel(t){this.isbottmpanel=!1,t.type==2&&(this.poster_img=t.poster_img,this.isCreatedImg=!0)},favorite(){let t=this;t._post("course.Favorite/fav",{course_id:t.course_id},l=>{t.is_fav?(e.index.showToast({icon:"none",title:"取消成功"}),t.is_fav=!1):(e.index.showToast({icon:"none",title:"收藏成功，请到“我的->我的课程”查看和管理哦"}),t.is_fav=!0)})},showHShare(){window.location.href=this.websiteUrl+"/download?id="+this.course_id+"&type=2"},closeAppShare(t){this.isAppShare=!1}}};if(!Array){const t=e.resolveComponent("empty"),l=e.resolveComponent("comment"),s=e.resolveComponent("share"),a=e.resolveComponent("concatMask"),i=e.resolveComponent("AppShare"),n=e.resolveComponent("Cashier"),o=e.resolveComponent("Buy");(t+l+s+a+i+n+o)()}function y(t,l,s,a,i,n){return e.e({a:!i.loadding},i.loadding?{}:e.e({b:i.detail.video_link!=""},i.detail.video_link!=""?e.e({c:!i.isVideoPlay},i.isVideoPlay?{}:{d:e.o(o=>i.isVideoPlay=!0)},{e:!i.isVideoPlay},i.isVideoPlay?{}:{f:i.detail.video_image?i.detail.video_image:n.getimg(),g:e.o(o=>i.isVideoPlay=!0)},{h:i.isVideoPlay},i.isVideoPlay?{i:i.isVideoPlay,j:i.detail.video_link}:{}):{},{k:e.f(i.detail.banner,(o,r,c)=>({a:e.o(d=>n.gotoLast(),r),b:o.file_path,c:r})),l:i.indicatorDots,m:i.autoplay,n:i.interval,o:i.duration,p:e.o((...o)=>n.changeSwiper&&n.changeSwiper(...o)),q:e.t(i.detail.title),r:e.f(i.detail.label,(o,r,c)=>({a:e.t(o),b:r})),s:i.detail.is_pay==0},i.detail.is_pay==0?{}:{},{t:i.detail.is_pay==1},i.detail.is_pay==1?{v:e.t(i.detail.course_price)}:{},{w:i.is_fav?"/static/image/sc_add.png":"/static/image/sc_quxiao.png",x:e.n(i.is_fav?"red":"gray6"),y:e.o(o=>n.favorite()),z:e.o((...o)=>n.showShare&&n.showShare(...o)),A:e.t(i.detail.sectionNum),B:e.t(i.detail.browse_count),C:i.detail.lecturer},i.detail.lecturer?{D:e.f(i.detail.lecturer,(o,r,c)=>({a:o.image&&o.image.file_path,b:e.t(o.name),c:e.t(o.label&&o.label.length>0&&o.label[0]),d:o,e:e.o(d=>t.gotoPage("/pages/knowledge/lecturer/detail?lecturer_id="+o.lecturer_id),o)}))}:{},{E:e.f(i.tabList,(o,r,c)=>({a:e.t(o.key),b:o,c:o.value==i.activeName?1:"",d:e.o(d=>n.changTab(o),o)})),F:i.activeName==0},i.activeName==0?e.e({G:i.detail.content},i.detail.content?{H:i.detail.content}:{I:e.p({desc:"暂无详情"})}):{},{J:i.activeName==1},i.activeName==1?e.e({K:i.detail.section&&i.detail.section.length>0},i.detail.section&&i.detail.section.length>0?{L:e.f(i.detail.section,(o,r,c)=>e.e({a:e.t(o.title),b:e.t(o.lecturer&&o.lecturer.name),c:e.t(o.start_time_text)},e.e({d:o.status==0},o.status==0?{}:o.status==1?{}:o.status==2?{}:{},{e:o.status==1,f:o.status==2}),{g:e.o(d=>n.gotoLive(o),r),h:r}))}:{M:e.p({desc:"暂无课表"})}):{},{N:i.activeName==2},i.activeName==2?{O:e.sr("commentRef","f1e0da38-2")}:{},{P:e.s("height:"+i.scrollviewHigh+"px")}),{Q:e.o(o=>t.gotoPage("/pages/index/index")),R:i.detail.is_pay==0},i.detail.is_pay==0?e.e({S:i.detail.payStatus>0},i.detail.payStatus>0?{T:e.o((...o)=>n.getConcat&&n.getConcat(...o))}:{},{U:i.detail.payStatus==0},i.detail.payStatus==0?{V:e.o((...o)=>n.getToConcat&&n.getToConcat(...o))}:{}):e.e({W:i.detail.payStatus==0},i.detail.payStatus==0?{X:e.t(i.detail.course_price),Y:e.o(o=>n.toPay())}:{Z:e.o((...o)=>n.getConcat&&n.getConcat(...o))}),{aa:e.o(n.closeBottmpanel),ab:e.p({isbottmpanel:i.isbottmpanel,course_id:i.course_id}),ac:e.sr("concatRef","f1e0da38-4"),ad:e.o(n.closeAppShare),ae:e.p({isAppShare:i.isAppShare,appParams:i.appParams}),af:e.o(n.closeCashier),ag:e.p({isPopup:i.isPay,course_id:i.course_id,room_id:i.room_id,price:i.detail.course_price}),ah:e.o(n.closeBuy),ai:e.p({isPopup:i.isPopup})})}const w=e._export_sfc(v,[["render",y],["__scopeId","data-v-f1e0da38"],["__file","D:/phpstudy_pro/www3/jjj_edu_small/jjj_edu_app/pages/eduadmin/detail.vue"]]);wx.createPage(w);
