"use strict";const s=require("../../../common/vendor.js"),a=require("../../../common/utils.js"),g={data(){return{loading:!0,weeklist:["日","一","二","三","四","五","六"],daylist:[],year:null,today_year:null,month:null,today_month:null,day:null,today_day:null,list:[],reward:[],days:0,today:0,is_sign:!1,point:[],rule:""}},mounted(){this.init()},onShow(){this.getData(),this.getRule()},methods:{getRule(){let t=this;t._get("plus.sign.sign/getSign",{},function(n){n.data.detail=a.utils.format_content(n.data.detail),t.rule=n.data.detail})},getData(){let t=this;s.index.showLoading({title:"加载中"}),t._get("plus.sign.sign/index",{},function(n){t.list=n.data.list[0],t.days=n.data.list[1],t.today=n.data.list[2],t.reward=n.data.arr,t.point=n.data.point,t.list.indexOf(t.day)>=0&&(t.is_sign=!0),t.loading=!1,s.index.hideLoading()})},onSign(){let t=this;if(t.is_sign)return s.index.showToast({title:"今天已签到",duration:2e3}),!1;s.index.showLoading({title:"正在提交",mask:!0}),t._get("plus.sign.sign/add",{},function(n){s.index.hideLoading(),t.showSuccess(n.data.msg,function(){t.getData()})})},init(){if(this.year===null&&this.month===null&&this.day===null){let t=new Date;this.year=t.getFullYear(),this.today_year=t.getFullYear(),this.month=t.getMonth(),this.today_month=t.getMonth()+1,this.day=t.getDate(),this.today_day=t.getDate()}this.joinDay()},joinDay(){let t=[],n=this.getMonthCount(this.year,this.month),o=this.getPreMonthCount(this.year,this.month),l=this.getNextMonthCount(this.year,this.month),e=this.getWeekday(this.year,this.month),r=[];e!=0&&(r=o.slice(-1*e));let i=l.slice(0,42-n.length-e),h=this.numConvertNode(r,"pre"),d=this.numConvertNode(n,null),u=this.numConvertNode(i,"next");t=[].concat(h,d,u),this.daylist=t},numConvertNode(t,n){let o=0,l=[],e=t.length;n!=null&&(n=="pre"?o=-1:(o=1,e>7&&(e=e-7)));for(let r=0;r<e;r++){let i={type:o,day:t[r]};l.push(i)}return l},isLeapYear(t){return t%400===0||t%100!==0&&t%4===0},getMonthCount(t,n){let l=[31,null,31,30,31,30,31,31,30,31,30,31][n]||(this.isLeapYear(t)?29:28);return Array.from(new Array(l),(e,r)=>r+1)},getWeekday(t,n){return new Date(t,n,1).getDay()},getPreMonthCount(t,n){return n===0?this.getMonthCount(t-1,11):this.getMonthCount(t,n-1)},getNextMonthCount(t,n){return n===11?this.getMonthCount(t+1,0):this.getMonthCount(t,n+1)},gotoRuleFunc(){this.gotoPage("/pages/plus/signin/rule/rule")}}};function y(t,n,o,l,e,r){return s.e({a:!e.loading},e.loading?{}:s.e({b:e.reward.length>0&&e.reward[0]>=1},e.reward.length>0&&e.reward[0]>=1?{c:s.t(e.reward[0]),d:s.t(e.point[e.reward[0]]),e:s.t(t.points_name())}:{},{f:e.reward.length>0&&e.reward[0]==1&&!e.is_sign},e.reward.length>0&&e.reward[0]==1&&!e.is_sign?{}:{},{g:!e.is_sign},e.is_sign?{}:{h:s.o((...i)=>r.onSign&&r.onSign(...i))},{i:s.t(e.days),j:s.t(e.today_year),k:s.t(e.today_month),l:s.f(e.weeklist,(i,h,d)=>({a:s.t(i),b:h})),m:s.f(e.daylist,(i,h,d)=>s.e({a:e.list.indexOf(i.day)>-1&&i.type==0},e.list.indexOf(i.day)>-1&&i.type==0?{b:s.t(i.day)}:{},{c:e.list.indexOf(i.day)==-1},e.list.indexOf(i.day)==-1?s.e({d:e.reward.indexOf(i.day-e.today)>-1&&i.type==0},e.reward.indexOf(i.day-e.today)>-1&&i.type==0?{}:{},{e:i.type==0&&e.reward.indexOf(i.day-e.today)==-1},i.type==0&&e.reward.indexOf(i.day-e.today)==-1?{f:s.t(i.day)}:{}):{},{g:s.n(i.type!=0?"secondary-date-item":""),h})),n:e.rule,o:t.theme(),p:s.n(t.theme()||"")}))}const f=s._export_sfc(g,[["render",y],["__file","D:/phpstudy_pro/www3/jjj_edu_small/jjj_edu_app/pages/plus/signin/signin.vue"]]);wx.createPage(f);
