"use strict";const o=require("../../../common/vendor.js"),p=()=>"../../../components/upload/upload.js",m=()=>"../../../components/uni-popup.js",c={components:{Upload:p,Popup:m},data(){return{userInfo:{},isUpload:!1,isPopup:!1,newName:"",type:"",version_no:"",imageList:[]}},onShow(){this.getData()},methods:{onChooseAvatar(e){let n=this;console.log(e),n.uploadFile([e.detail.avatarUrl])},getData(){let e=this;o.index.showLoading({title:"加载中"}),e._get("user.index/setting",{},function(n){e.userInfo=n.data.userInfo,o.index.hideLoading()})},gotoBind(){this.gotoPage("/pages/user/modify-phone/modify-phone")},logout(){o.index.removeStorageSync("token"),o.index.removeStorageSync("user_id"),o.index.switchTab({url:"/pages/index/index"})},changeName(e){let n=this;e=="mobile"&&(n.oldmobile=n.userInfo.mobile),n.type=e,n.newName=n.userInfo[e],n.isPopup=!0},hidePopupFunc(){this.newName="",this.isPopup=!1},changeinput(e){this.newName=e.target.value},clearName(){this.newName=""},subName(e){let n=this;n.loading||(n.newName=e.detail.value.newName,console.log(e.detail.value.newName),n.userInfo[n.type]=this.newName,n.update())},changeAvatarUrl(){let e=this;e.isUpload=!0},uploadFile:function(e){let n=this,a=0,l=e.length,i={token:o.index.getStorageSync("token"),app_id:n.getAppId()};o.index.showLoading({title:"图片上传中"}),e.forEach(function(t,s){o.index.uploadFile({url:n.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:t,name:"iFile",formData:i,success:function(u){let r=typeof u.data=="object"?u.data:JSON.parse(u.data);r.code===1?n.imageList.push(r.data):n.showError(r.msg)},complete:function(){a++,l===a&&(o.index.hideLoading(),n.getImgsFunc(n.imageList))}})})},getImgsFunc(e){let n=this;if(n.isUpload=!1,e&&typeof e<"u"){let a=this;a.userInfo.avatarUrl=e[0].file_path,a.update()}},update(){let e=this;if(e.loading)return;o.index.showLoading({title:"加载中"});let n=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",n,function(a){e.showSuccess("修改成功",function(){e.loading=!1,e.isPopup=!1,o.index.hideLoading(),e.getData()},function(l){o.index.hideLoading(),e.loading=!1,e.isPopup=!1})})}}};if(!Array){const e=o.resolveComponent("Popup"),n=o.resolveComponent("Upload");(e+n)()}function d(e,n,a,l,i,t){return o.e({a:i.userInfo.avatarUrl||"/static/default.png",b:o.o((...s)=>t.onChooseAvatar&&t.onChooseAvatar(...s)),c:o.t(i.userInfo.user_id),d:o.t(i.userInfo.nickName),e:o.o(s=>t.changeName("nickName")),f:i.userInfo.mobile},i.userInfo.mobile?{g:o.t(i.userInfo.mobile)}:{},{h:!i.userInfo.mobile},i.userInfo.mobile?{}:{i:o.o((...s)=>t.gotoBind&&t.gotoBind(...s))},{j:o.o(s=>t.logout()),k:i.type=="mobile"||i.type=="nickName"||i.type=="user_name"||i.type=="email"||i.type=="idcard"},i.type=="mobile"||i.type=="nickName"||i.type=="user_name"||i.type=="email"||i.type=="idcard"?{l:i.type=="nickName"?"nickname":"text",m:i.newName,n:o.o((...s)=>t.changeinput&&t.changeinput(...s)),o:o.o((...s)=>t.clearName&&t.clearName(...s))}:{},{p:o.o((...s)=>t.hidePopupFunc&&t.hidePopupFunc(...s)),q:o.o((...s)=>t.subName&&t.subName(...s)),r:o.o(t.hidePopupFunc),s:o.p({show:i.isPopup,type:"bottom",width:750,padding:0}),t:i.isUpload},i.isUpload?{v:o.o(t.getImgsFunc),w:o.p({num:1})}:{})}const f=o._export_sfc(c,[["render",d],["__file","D:/phpstudy_pro/www3/jjj_edu_small/jjj_edu_app/pages/user/set/set.vue"]]);wx.createPage(f);
