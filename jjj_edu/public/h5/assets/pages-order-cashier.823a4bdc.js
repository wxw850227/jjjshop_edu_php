import{aj as e,ak as a,_ as t,U as r,P as c,B as s,D as o,o as d,a as n,w as i,n as p,f as l,d as y,e as u,t as _,b as f,r as h,F as m,ae as g,p as b,i as k,al as P,y as x}from"./index-db1fe3c3.js";function T(a,t,r){r?r(a):function(a){e({url:"/pages/order/pay-success/pay-success?order_id="+a.data.order_id})}(a)}function w(e,t){t?t(e):a({url:"/pages/order/order-detail?order_id="+e.data.order_id})}const C=t({data:()=>({balance:"",balanceType:!1,type:0,loading:!0,order_id:0,order_type:0,pay_type:20,checkedPay:[],payPrice:"",type:""}),computed:{hasBanlance(){return-1!=this.checkedPay.indexOf(10)}},onLoad(e){this.order_id=e.order_id,e.order_type&&(this.order_type=e.order_type),this.type=e.type,this.getData()},onBackPress(e){if(30!=this.order_type&&20!=this.order_type)return"navigateBack"===e.from?(console.log(),!0):(this.back(),!0)},methods:{back(){let e=this;r({title:"提示",content:"您的订单如在规定时间内未支付将被取消，请尽快完成支付",cancelText:"继续支付",confirmText:"确认离开",success:function(a){if(a.confirm){let a="";"course"==e.type?a="/pages/order/course":"eduadmin"==e.type?a="/pages/order/teacher":"paper"==e.type&&(a="/pages/order/exam"),e.gotoPage(`${a}`,"reLaunch")}else a.cancel&&(c(),console.log("用户点击取消"))}})},getData(){let e,a=this;a.loading=!0,s({title:"加载中"}),20==a.order_type&&(e="balance.Plan/pay"),30==a.order_type&&(e="plus.points.order/pay"),10==a.order_type&&(e="user.Order/pay");let t={order_id:a.order_id,pay_source:a.getPlatform()};a._get(e,t,(function(e){a.loading=!1;let t=[];e.data.payTypes.payType.forEach((e=>{t.push(1*e)})),a.checkedPay=t,a.payPrice=e.data.payPrice,a.balance=e.data.balance||"",10!=a.checkedPay[0]?a.pay_type=a.checkedPay[0]||a.checkedPay[1]||20:a.pay_type=a.checkedPay[1]||a.checkedPay[0],o()}))},switch2Change(e){this.balanceType=e.detail.value},submit(){let e=this;e.loading=!0,s({title:"加载中"});let a="user.order/pay";20==e.order_type&&(a="balance.Plan/pay"),30==e.order_type&&(a="plus.points.order/pay"),10==e.order_type&&(a="user.Order/pay");let t=1==e.balanceType?1:0;0==e.payPrice&&(t=1);let r=e.pay_type;10==r&&(r=0);let c={order_id:e.order_id,pay_source:e.getPlatform(),payType:r,use_balance:t};e._post(a,c,(function(a){e.loading=!1,o(),((e,a,t,r)=>{if(-10===e.code)return a.showError(e.msg),!1;if(20==e.data.pay_type){if(!a.isWeixin())return void(window.location.href=e.data.payment.h5_url+"&redirect_url="+e.data.return_Url);WeixinJSBridge.invoke("getBrandWCPayRequest",e.data.payment,(function(c){"get_brand_wcpay_request:ok"==c.err_msg?T(e,0,t):"get_brand_wcpay_request:cancel"==c.err_msg?a.showSuccess("支付取消",(()=>{w(e,r)})):a.showError("订单未支付成功",(()=>{w(e,r)}))}))}if(10==e.data.pay_type&&T(e,0,t),30==e.data.pay_type){const a=document.createElement("formdiv");a.innerHTML=e.data.payment,document.body.appendChild(a),document.forms[0].submit(),a.remove()}})(a,e,e.paySuccess,e.payError)}))},paySuccess(e){let a=this;30==a.order_type?a.gotoPage(`/pages/order/paySuccess/course?order_id=${e.data.order_id}&order_type=point`,"reLaunch"):10==a.order_type&&a.gotoPage(`/pages/order/paySuccess/course?order_id=${e.data.order_id}&order_type=${a.type}`,"reLaunch")},payError(e){let a=this,t="";"course"==a.type?t="/pages/order/course":"eduadmin"==a.type?t="/pages/order/teacher":"paper"==a.type&&(t="/pages/order/exam"),a.gotoPage(`${t}`,"redirect")},payTypeFunc(e){this.pay_type=e}}},[["render",function(e,a,t,r,c,s){const o=l,T=k,w=P,C=x;return d(),n(o,{"data-theme":e.theme(),class:p(e.theme()||"")},{default:i((()=>[y(o,{class:"tc buy-checkout-top"},{default:i((()=>[y(o,{class:"f32 mb20"},{default:i((()=>[u("待支付")])),_:1}),y(o,{class:"redA8 f60 fb"},{default:i((()=>[u("￥"+_(c.payPrice||""),1)])),_:1})])),_:1}),y(o,{class:"buy-checkout p-0-30"},{default:i((()=>[(d(!0),f(m,null,h(c.checkedPay,((e,t)=>(d(),n(o,{key:t},{default:i((()=>[20==e?(d(),n(o,{key:0,class:p(20==c.pay_type?"item active":"item"),onClick:a[0]||(a[0]=e=>s.payTypeFunc(20))},{default:i((()=>[y(o,{class:"d-s-c"},{default:i((()=>[y(o,{class:"icon-box d-c-c mr10"},{default:i((()=>[g("span",{class:"icon iconfont icon-weixin"})])),_:1}),y(T,{class:"key"},{default:i((()=>[u("微信支付：")])),_:1})])),_:1}),y(o,{class:"icon-box d-c-c"},{default:i((()=>[g("span",{class:"icon iconfont icon-xuanze"})])),_:1})])),_:1},8,["class"])):b("",!0),30==e?(d(),n(o,{key:1,class:p(30==c.pay_type?"item active":"item"),onClick:a[1]||(a[1]=e=>s.payTypeFunc(30))},{default:i((()=>[y(o,{class:"d-s-c"},{default:i((()=>[y(o,{class:"icon-box d-c-c mr10"},{default:i((()=>[g("span",{class:"icon iconfont icon-zhifubao"})])),_:1}),y(T,{class:"key"},{default:i((()=>[u("支付宝支付：")])),_:1})])),_:1}),y(o,{class:"icon-box d-c-c"},{default:i((()=>[g("span",{class:"icon iconfont icon-xuanze"})])),_:1})])),_:1},8,["class"])):b("",!0)])),_:2},1024)))),128)),s.hasBanlance&&c.balance>0?(d(),n(o,{key:0,class:"item"},{default:i((()=>[y(o,{class:"d-s-c"},{default:i((()=>[y(o,{class:"icon-box d-c-c mr10"},{default:i((()=>[g("span",{class:"icon iconfont icon-yue"})])),_:1}),y(T,{class:"key"},{default:i((()=>[u("余额抵扣：(剩余："+_(c.balance)+")",1)])),_:1})])),_:1}),y(w,{color:e.getThemeColor(),style:{transform:"scale(0.7)","margin-right":"-20rpx"},checked:c.balanceType,onChange:s.switch2Change},null,8,["color","checked","onChange"])])),_:1})):b("",!0)])),_:1}),y(o,{class:"bottom-btn",onClick:s.submit},{default:i((()=>[y(C,{type:"default"},{default:i((()=>[u("立即支付")])),_:1})])),_:1},8,["onClick"])])),_:1},8,["data-theme","class"])}],["__scopeId","data-v-69e11aa3"]]);export{C as default};
