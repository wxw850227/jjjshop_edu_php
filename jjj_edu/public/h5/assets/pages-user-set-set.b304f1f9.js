import{_ as e,B as a,D as s,a1 as t,J as o,C as l,a2 as n,o as i,a as u,w as d,f as c,d as p,e as f,t as r,p as m,i as g,k as h,I as _,y as b,a3 as w,h as y}from"./index-db1fe3c3.js";import{U as k}from"./upload.722988d7.js";import{P as I}from"./uni-popup.e532213d.js";const N=e({components:{Upload:k,Popup:I},data:()=>({userInfo:{},isUpload:!1,isPopup:!1,newName:"",type:"",version_no:"",imageList:[]}),onShow(){this.getData()},methods:{onChooseAvatar(e){console.log(e),this.uploadFile([e.detail.avatarUrl])},getData(){let e=this;a({title:"加载中"}),e._get("user.index/setting",{},(function(a){e.userInfo=a.data.userInfo,s()}))},gotoBind(){this.gotoPage("/pages/user/modify-phone/modify-phone")},logout(){t("token"),t("user_id"),o({url:"/pages/index/index"})},changeName(e){let a=this;"mobile"==e&&(a.oldmobile=a.userInfo.mobile),a.type=e,a.newName=a.userInfo[e],a.isPopup=!0},hidePopupFunc(){this.newName="",this.isPopup=!1},changeinput(e){this.newName=e.target.value},clearName(){this.newName=""},subName(e){let a=this;a.loading||(a.newName=e.detail.value.newName,console.log(e.detail.value.newName),a.userInfo[a.type]=this.newName,a.update())},changeAvatarUrl(){this.isUpload=!0},uploadFile:function(e){let t=this,o=0,i=e.length,u={token:l("token"),app_id:t.getAppId()};a({title:"图片上传中"}),e.forEach((function(e,a){n({url:t.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:e,name:"iFile",formData:u,success:function(e){let a="object"==typeof e.data?e.data:JSON.parse(e.data);1===a.code?t.imageList.push(a.data):t.showError(a.msg)},complete:function(){o++,i===o&&(s(),t.getImgsFunc(t.imageList))}})}))},getImgsFunc(e){if(this.isUpload=!1,e&&void 0!==e){let a=this;a.userInfo.avatarUrl=e[0].file_path,a.update()}},update(){let e=this;if(e.loading)return;a({title:"加载中"});let t=e.userInfo;e.loading=!0,e._post("user.user/updateInfo",t,(function(a){e.showSuccess("修改成功",(function(){e.loading=!1,e.isPopup=!1,s(),e.getData()}),(function(a){s(),e.loading=!1,e.isPopup=!1}))}))}}},[["render",function(e,a,s,t,o,l){const n=g,k=h,I=c,N=_,P=b,v=w,U=y("Popup"),C=y("Upload");return i(),u(I,{class:"address-form"},{default:d((()=>[p(I,{class:"bg-white p-0-30 f30"},{default:d((()=>[p(I,{class:"d-b-c border-b info-item avatar"},{default:d((()=>[p(n,{class:"key-name"},{default:d((()=>[f("头像")])),_:1}),p(I,{class:"d-e-c",onClick:l.changeAvatarUrl},{default:d((()=>[p(I,{class:"info-image"},{default:d((()=>[p(k,{src:o.userInfo.avatarUrl||"/static/default.png",mode:""},null,8,["src"])])),_:1}),p(n,{class:"icon iconfont icon-jiantou"})])),_:1},8,["onClick"])])),_:1}),p(I,{class:"d-b-c p-30-0 border-b"},{default:d((()=>[p(n,{class:"key-name"},{default:d((()=>[f("会员ID")])),_:1}),p(I,{class:"d-e-c"},{default:d((()=>[p(n,{class:"mr20"},{default:d((()=>[f(r(o.userInfo.user_id),1)])),_:1})])),_:1})])),_:1}),p(I,{class:"d-b-c p-30-0 border-b"},{default:d((()=>[p(n,{class:"key-name"},{default:d((()=>[f("昵称")])),_:1}),p(I,{class:"d-e-c",onClick:a[0]||(a[0]=e=>l.changeName("nickName"))},{default:d((()=>[p(n,{class:"mr20"},{default:d((()=>[f(r(o.userInfo.nickName),1)])),_:1}),p(n,{class:"icon iconfont icon-jiantou"})])),_:1})])),_:1}),p(I,{class:"d-b-c p-30-0"},{default:d((()=>[p(n,{class:"key-name"},{default:d((()=>[f("手机号码")])),_:1}),o.userInfo.mobile?(i(),u(I,{key:0,class:"d-e-c"},{default:d((()=>[p(n,{class:"mr20"},{default:d((()=>[f(r(o.userInfo.mobile),1)])),_:1})])),_:1})):m("",!0),o.userInfo.mobile?m("",!0):(i(),u(I,{key:1,class:"d-e-c",onClick:l.gotoBind},{default:d((()=>[p(n,{class:"mr20"},{default:d((()=>[f("未绑定")])),_:1}),p(n,{class:"iconfont icon-jiantou"})])),_:1},8,["onClick"]))])),_:1}),p(I,{class:"setup-btn",onClick:a[1]||(a[1]=e=>l.logout())},{default:d((()=>[f("退出登录")])),_:1})])),_:1}),p(U,{show:o.isPopup,type:"bottom",width:750,padding:0,onHidePopup:l.hidePopupFunc},{default:d((()=>[p(v,{onSubmit:l.subName},{default:d((()=>[p(I,{class:"d-s-s d-c p20 mpservice-wrap"},{default:d((()=>[p(I,{class:"tc f32 fb ww100"},{default:d((()=>[f("修改")])),_:1}),"mobile"==o.type||"nickName"==o.type||"user_name"==o.type||"email"==o.type||"idcard"==o.type?(i(),u(I,{key:0,class:"pop-input d-b-c"},{default:d((()=>[p(N,{type:"text"==o.type,name:"newName",class:"flex-1",placeholder:"请输入",modelValue:o.newName,"onUpdate:modelValue":a[2]||(a[2]=e=>o.newName=e)},null,8,["type","modelValue"]),p(I,{class:"icon-guanbi icon iconfont",onClick:l.clearName},null,8,["onClick"])])),_:1})):m("",!0),p(I,{class:"d-a-c ww100"},{default:d((()=>[p(P,{class:"btn-gray-border",onClick:l.hidePopupFunc},{default:d((()=>[f("取消")])),_:1},8,["onClick"]),p(P,{class:"theme-btn","form-type":"submit"},{default:d((()=>[f("确认")])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["show","onHidePopup"]),o.isUpload?(i(),u(C,{key:0,num:1,onGetImgs:l.getImgsFunc},null,8,["onGetImgs"])):m("",!0)])),_:1})}],["__scopeId","data-v-a5c6d55a"]]);export{N as default};
