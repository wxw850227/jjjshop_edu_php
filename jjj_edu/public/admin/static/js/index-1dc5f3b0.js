import{E as e,c as t,d as o,e as i,f as s}from"./element-plus-fe2e4fed.js";import{_ as r,u as a,b as n,a as l,c as d,d as m}from"./index-68daabb5.js";import{o as u,c as h,a as c,P as p,S as f,V as g,X as y,a1 as C,W as b}from"./@vue-0361ad4a.js";import{I as j}from"./index-c41921e8.js";import{U as N}from"./user-2b4a453e.js";import"./lodash-es-3593bb86.js";import"./async-validator-cf877c1f.js";import"./@vueuse-19751edd.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-1634e2d0.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-64e93849.js";import"./pinia-3f36854e.js";import"./axios-15f6fe35.js";import"./qs-c6aa5595.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./vue-clipboard2-259f629a.js";import"./clipboard-e6665d4e.js";import"./vue-ueditor-wrap-f5452c05.js";const v={class:"s-canvas"},M=["width","height"];const x=r({name:"SIdentify",props:{identifyCode:{type:String,default:"1234"},fontSizeMin:{type:Number,default:25},fontSizeMax:{type:Number,default:30},backgroundColorMin:{type:Number,default:255},backgroundColorMax:{type:Number,default:255},colorMin:{type:Number,default:0},colorMax:{type:Number,default:160},lineColorMin:{type:Number,default:100},lineColorMax:{type:Number,default:255},dotColorMin:{type:Number,default:0},dotColorMax:{type:Number,default:255},contentWidth:{type:Number,default:112},contentHeight:{type:Number,default:41}},methods:{randomNum:(e,t)=>Math.floor(Math.random()*(t-e)+e),randomColor(e,t){return"rgb("+this.randomNum(e,t)+","+this.randomNum(e,t)+","+this.randomNum(e,t)+")"},drawPic(){let e=document.getElementById("s-canvas").getContext("2d");e.textBaseline="bottom",e.fillStyle=this.randomColor(this.backgroundColorMin,this.backgroundColorMax),e.fillRect(0,0,this.contentWidth,this.contentHeight);for(let t=0;t<this.identifyCode.length;t++)this.drawText(e,this.identifyCode[t],t);this.drawLine(e),this.drawDot(e)},drawText(e,t,o){e.fillStyle=this.randomColor(this.colorMin,this.colorMax),e.font=this.randomNum(this.fontSizeMin,this.fontSizeMax)+"px SimHei";let i=(o+1)*(this.contentWidth/(this.identifyCode.length+1)),s=this.randomNum(this.fontSizeMax,this.contentHeight-5);var r=this.randomNum(-45,45);e.translate(i,s),e.rotate(r*Math.PI/180),e.fillText(t,0,0),e.rotate(-r*Math.PI/180),e.translate(-i,-s)},drawLine(e){for(let t=0;t<5;t++)e.strokeStyle=this.randomColor(this.lineColorMin,this.lineColorMax),e.beginPath(),e.moveTo(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight)),e.lineTo(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight)),e.stroke()},drawDot(e){for(let t=0;t<80;t++)e.fillStyle=this.randomColor(0,255),e.beginPath(),e.arc(this.randomNum(0,this.contentWidth),this.randomNum(0,this.contentHeight),1,0,2*Math.PI),e.fill()}},watch:{identifyCode(){this.drawPic()}},mounted(){this.drawPic()}},[["render",function(e,t,o,i,s,r){return u(),h("div",v,[c("canvas",{id:"s-canvas",width:o.contentWidth,height:o.contentHeight},null,8,M)])}],["__scopeId","data-v-00d68c2f"]]),{afterLogin:k}=a(),_={components:{sidentify:x},data(){return{loginForm:{},identifyCodes:"1234567890",identifyCode:"",loading:!0,shop_name:"",bgimg_url:"",logining:!1,ruleForm:{account:"",checkPass:""},rules:{account:[{required:!0,message:"请输入用户名",trigger:"blur"}],checkPass:[{required:!0,message:"请输入密码",trigger:"blur"}],verifycode:[{required:!0,trigger:"blur",validator:(e,t,o)=>{""===t?(this.refreshCode(),o(new Error("请输入验证码"))):t!==this.identifyCode?(this.refreshCode(),o(new Error("验证码不正确!"))):o()}}]},baseData:{}}},created(){this.refreshCode(),this.getData(),this.$route.query.from&&"admin"==this.$route.query.from&&this.saasLogin()},mounted(){this.identifyCode="",this.makeCode(this.identifyCodes,4)},methods:{randomNum:(e,t)=>Math.floor(Math.random()*(t-e)+e),refreshCode(){this.identifyCode="",this.makeCode(this.identifyCodes,4)},makeCode(e,t){for(let o=0;o<t;o++)this.identifyCode+=this.identifyCodes[this.randomNum(0,this.identifyCodes.length)]},refreshCode(){this.identifyCode="",this.makeCode(this.identifyCodes,4)},getData(){let e=this;j.base(!0).then((t=>{e.loading=!1,e.shop_name=t.data.settings.shop_name,""!=t.data.settings.shop_bg_img?e.bgimg_url=t.data.settings.shop_bg_img:e.bgimg_url=n})).catch((t=>{e.loading=!1}))},SubmitFunc(t){this.$refs.ruleForm.validate((t=>{if(t){this.logining=!0;var o={username:this.ruleForm.account,password:this.ruleForm.checkPass};N.login(o,!0).then((async t=>{this.logining=!1,1==t.code?(await k(t),this.$router.push({path:"/"})):e({message:"登录失败",type:"error"})})).catch((e=>{this.logining=!1}))}}))},saasLogin(){N.saasLogin({},!0).then((t=>{1==t.code?(delCookie("baseInfo"),setCookie("userinfo",t.data),setCookie("isLogin",!0),this.$router.push({path:"/"})):e({message:"登录失败",type:"error"})})).catch((e=>{}))}}},w={class:"title"},F={class:"left-img-input"},P=c("img",{class:"l-img",src:l},null,-1),S={class:"left-img-input"},V=c("img",{class:"l-img",src:d},null,-1),H={class:"left-img-input"},I=c("img",{class:"l-img",src:m},null,-1);const W=r(_,[["render",function(e,r,a,n,l,d){const m=o,j=i,N=x,v=s,M=t;return u(),h("div",{class:"login-bg",style:g("background-image:url("+l.bgimg_url+");")},[p(M,{model:l.ruleForm,rules:l.rules,ref:"ruleForm","label-position":"left","label-width":"0px",class:"demo-ruleForm login-container"},{default:f((()=>[c("h3",w,y(l.shop_name),1),p(j,{prop:"account"},{default:f((()=>[c("div",F,[P,p(m,{class:"l-input",type:"text",modelValue:l.ruleForm.account,"onUpdate:modelValue":r[0]||(r[0]=e=>l.ruleForm.account=e),"auto-complete":"off",placeholder:"账号"},null,8,["modelValue"])])])),_:1}),p(j,{prop:"checkPass"},{default:f((()=>[c("div",S,[V,p(m,{class:"l-input",type:"password",modelValue:l.ruleForm.checkPass,"onUpdate:modelValue":r[1]||(r[1]=e=>l.ruleForm.checkPass=e),"auto-complete":"off",placeholder:"密码"},null,8,["modelValue"])])])),_:1}),p(j,{prop:"verifycode",style:{"line-height":"0px"}},{default:f((()=>[c("div",H,[I,p(m,{class:"l-input",type:"text",modelValue:l.ruleForm.verifycode,"onUpdate:modelValue":r[2]||(r[2]=e=>l.ruleForm.verifycode=e),"auto-complete":"off",placeholder:"验证码"},null,8,["modelValue"]),p(N,{identifyCode:l.identifyCode},null,8,["identifyCode"])])])),_:1}),p(j,null,{default:f((()=>[p(v,{class:"login-btn",onClick:C(d.SubmitFunc,["prevent"]),loading:l.logining},{default:f((()=>[b("登录 ")])),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])],4)}]]);export{W as default};
