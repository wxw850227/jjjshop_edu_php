import{_ as e}from"./AddCategory-1e090b14.js";import{a as t,E as i,B as a,f as l,C as o,D as s,y as c,n,o as r}from"./element-plus-fe2e4fed.js";import{F as g}from"./file-437a81f7.js";import{ae as d,o as p,c as u,P as h,S as f,a as y,W as m,Q as C,a9 as _,X as k,M as v,a1 as F,Y as b,V as w,T as z}from"./@vue-0361ad4a.js";import{_ as L}from"./index-49a7d7a3.js";const S={class:"upload-wrap"},D={class:"upload-wrap-inline mb16 clearfix"},T={class:"leval-item"},x={class:"move-type"},j=["onClick"],I={class:"leval-item upload-btn"},B={class:"fileContainer"},P={class:"file-type"},U=["onClick"],V=["onClick"],E=["onClick"],N={class:"file-content"},W={class:"fileContainerUI clearfix"},q=["onClick"],A={key:0,class:"selectedIcon"},$=["scr"],M=["src"],O={class:"desc"},Q=["onClick"],X={class:"pagination-wrap"},Y={class:"dialog-footer"};const G=L({components:{AddCategory:e},data:()=>({dialogWidth:"910px",activeType:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1,file_type:"image"},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1,category:null,fileIds:[],accept:""}),props:["config"],created(){if("[object object]"===Object.prototype.toString.call(this.config).toLowerCase()){for(let e in this.config)this.config[e]&&(this.this_config[e]=this.config[e]);"image"==this.this_config.file_type?this.accept="image/jpeg,image/png,image/jpg":"video"==this.this_config.file_type?this.accept="video/mp4":"audio"==this.this_config.file_type?this.accept="audio/mp3":"pdf"==this.this_config.file_type&&(this.accept="pdf")}this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this;g.fileCategory({type:e.this_config.file_type},!0).then((t=>{e.typeList=[{group_id:null,group_name:"全部"}].concat(t.data.group_list)})).catch((t=>{e.loading=!1}))},addCategory(){this.isShowCategory=!0},editCategoryFunc(e){this.isShowCategory=!0,this.category=e},closeCategoryFunc(e){null!=e&&this.getFileCategory(),this.category=null,this.isShowCategory=!1},deleteCategoryFunc(e){t.confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteCategory(e)})).catch((()=>{i({type:"info",message:"已取消删除"})}))},deleteCategory(e){let t=this;g.deleteCategory({group_id:e}).then((e=>{i({message:"删除成功",type:"success"}),t.getFileCategory()})).catch((e=>{i.error("删除失败")}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getData()},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData:function(){let e=this,t={page:e.curPage,pageSize:e.pageSize,group_id:e.activeType,type:e.this_config.file_type};g.fileList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.file_list,e.totalDataNumber=e.fileList.total})).catch((t=>{e.loading=!1}))},moveTypeFunc(e){let a=this,l=[];a.fileList.data.forEach((e=>{e.selected&&l.push(e.file_id)})),0!=l.length?t.confirm("确定移动选中的文件吗?是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{g.moveFile({group_id:e,fileIds:l},!0).then((e=>{i({message:"移动成功",type:"success"}),a.getFileCategory(),a.getData()})).catch((e=>{}))})).catch((()=>{})):i({message:"请选择文件",type:"warning"})},fileChange(e){},onBeforeUploadImage:e=>!0,UploadImage(e){let t=this;const l=a.service({lock:!0,text:"文件上传中,请等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),o=new FormData;o.append("iFile",e.file),o.append("group_id",t.activeType),o.append("file_type",t.this_config.file_type),g.uploadFile(o).then((i=>{l.close(),t.getData(),e.onSuccess()})).catch((t=>{l.close(),i({message:"本次上传文件失败",type:"warning"}),e.onError()}))},selectFileFunc(e,t){e.selected?(e.selected=!1,this.record--):(e.selected=!0,this.record++),this.fileList.data[t]=e},deleteFileFunc(e){let l=this;t.confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=a.service({lock:!0,text:"正在删除",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let o=[];if(e)o.push(e.file_id);else for(let e=0;e<l.fileList.data.length;e++){let t=l.fileList.data[e];t.selected&&o.push(t.file_id)}g.deleteFiles({fileIds:o},!0).then((e=>{t.close(),i({message:"删除成功",type:"success"}),l.getData()})).catch((e=>{t.close()}))})).catch((()=>{loading.close(),i({message:"删除失败",type:"warning"})}))},confirmFunc(){let e=[],t=0;for(let i=0;i<this.fileList.data.length;i++){let a=this.fileList.data[i];if(a.selected){let i={file_id:a.file_id,file_path:a.file_path,real_name:a.real_name};e.push(i),t++}if(t>this.this_config.total)break}this.$emit("returnImgs",e)},cancelFunc(){this.$emit("returnImgs",null)}}},[["render",function(t,i,a,g,L,G){const H=l,J=o,K=s,R=d("Edit"),Z=c,ee=d("Delete"),te=d("Check"),ie=n,ae=r,le=e;return p(),u("div",S,[h(ae,{title:"文件管理",modelValue:L.dialogVisible,"onUpdate:modelValue":i[3]||(i[3]=e=>L.dialogVisible=e),"close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,onClose:G.cancelFunc,width:L.dialogWidth,"append-to-body":!0},{footer:f((()=>[y("div",Y,[h(H,{size:"small",onClick:G.cancelFunc},{default:f((()=>[m("取 消")])),_:1},8,["onClick"]),h(H,{size:"small",type:"primary",onClick:G.confirmFunc},{default:f((()=>[m("确 定")])),_:1},8,["onClick"])])])),default:f((()=>[y("div",D,[y("div",T,[h(H,{size:"small",icon:"Plus",onClick:G.addCategory},{default:f((()=>[m("添加分类")])),_:1},8,["onClick"]),h(J,{placement:"bottom",width:"200",trigger:"click",value:!0},{reference:f((()=>[h(H,{size:"small",icon:"CaretBottom"},{default:f((()=>[m("移动至")])),_:1})])),default:f((()=>[y("ul",x,[(p(!0),u(C,null,_(L.typeList,((e,t)=>(p(),u("li",{key:t,onClick:t=>G.moveTypeFunc(e.group_id)},k(e.group_name),9,j)))),128))])])),_:1}),h(H,{size:"small",type:"danger",icon:"Delete",onClick:i[0]||(i[0]=e=>G.deleteFileFunc(!1))},{default:f((()=>[m("批量删除")])),_:1})]),y("div",I,[h(K,{class:"avatar-uploader",multiple:"",ref:"upload",action:"string",accept:L.accept,"before-upload":G.onBeforeUploadImage,"http-request":G.UploadImage,"show-file-list":!1,"on-change":G.fileChange},{default:f((()=>[h(H,{size:"small",icon:"Upload",type:"primary"},{default:f((()=>[m("点击上传")])),_:1})])),_:1},8,["accept","before-upload","http-request","on-change"])])]),y("div",B,[y("div",P,[y("ul",null,[(p(!0),u(C,null,_(L.typeList,((e,t)=>(p(),u("li",{class:v(L.activeType==e.group_id?"item active":"item"),key:t,onClick:t=>G.selectTypeFunc(e.group_id)},[m(k(e.group_name)+" ",1),null!=e.group_id?(p(),u("div",{key:0,class:"operation",onClick:i[1]||(i[1]=F((()=>{}),["stop"]))},[y("p",{onClick:t=>G.editCategoryFunc(e)},[h(Z,null,{default:f((()=>[h(R)])),_:1})],8,V),y("p",{onClick:t=>G.deleteCategoryFunc(e.group_id)},[h(Z,null,{default:f((()=>[h(ee)])),_:1})],8,E)])):b("",!0)],10,U)))),128))])]),y("div",N,[y("ul",W,[(p(!0),u(C,null,_(L.fileList.data,((e,t)=>(p(),u("li",{class:"file",key:t,onClick:i=>G.selectFileFunc(e,t)},[1==e.selected?(p(),u("div",A,[h(Z,null,{default:f((()=>[h(te)])),_:1})])):b("",!0),"image"==L.this_config.file_type?(p(),u("img",{key:1,scr:e.file_path,style:w("background-image:url("+e.file_path+")"),alt:""},null,12,$)):b("",!0),"video"==L.this_config.file_type?(p(),u("video",{key:2,height:"100",width:"100",src:e.file_path,autoplay:!1}," 您的浏览器不支持 video 标签 ",8,M)):b("",!0),y("p",O,k(e.real_name),1),y("div",{class:"bottom-shade",onClick:i[2]||(i[2]=F((()=>{}),["stop"]))},[y("a",{href:"javascript:void(0)",onClick:t=>G.deleteFileFunc(e)},[h(Z,null,{default:f((()=>[h(ee)])),_:1})],8,Q)])],8,q)))),128))])])]),y("div",X,[h(ie,{onSizeChange:G.handleSizeChange,onCurrentChange:G.handleCurrentChange,"current-page":L.curPage,"page-sizes":[12,24,36,42,48],"page-size":L.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:L.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),_:1},8,["modelValue","onClose","width"]),L.isShowCategory?(p(),z(le,{key:0,category:L.category,file_type:L.this_config.file_type,onCloseCategory:G.closeCategoryFunc},null,8,["category","file_type","onCloseCategory"])):b("",!0)])}]]);export{G as _};
