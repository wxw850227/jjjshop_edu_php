import{_ as e}from"./AddCategory-d39c217d.js";import{a as t,E as a,B as i,f as l,D as s,y as o,n as r,o as n}from"./element-plus-fe2e4fed.js";import{F as c}from"./file-498fee0c.js";import p from"./AddCategory-e0e963a7.js";import{ae as d,o as g,c as u,P as m,S as h,a as f,W as C,Q as y,a9 as j,M as _,X as v,a1 as F,Y as k,V as b,T as z}from"./@vue-0361ad4a.js";import{_ as w}from"./index-68daabb5.js";import"./lodash-es-3593bb86.js";import"./async-validator-cf877c1f.js";import"./@vueuse-19751edd.js";import"./dayjs-3a594381.js";import"./call-bind-8544b80b.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-1634e2d0.js";import"./@popperjs-b78c3215.js";import"./escape-html-1590d737.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./vue-router-64e93849.js";import"./pinia-3f36854e.js";import"./axios-15f6fe35.js";import"./qs-c6aa5595.js";import"./side-channel-b02c3a2b.js";import"./object-inspect-bd98d4ca.js";import"./vue-clipboard2-259f629a.js";import"./clipboard-e6665d4e.js";import"./vue-ueditor-wrap-f5452c05.js";const S={components:{AddCategory:p},data:()=>({dialogWidth:"910px",activeType:null,typeList:[],imageUrl:null,dialogVisible:!0,fileList:[],addLoading:!1,this_config:{total:1},record:0,loading:!0,tableData:[],pageSize:36,totalDataNumber:0,curPage:1,isShowCategory:!1}),props:["config"],created(){this.getFileCategory(),this.getData()},methods:{getFileCategory(){let e=this;c.fileCategory({},!0).then((t=>{e.typeList=[{group_id:null,group_name:"全部"}].concat(t.data.group_list)})).catch((t=>{e.loading=!1}))},addCategory:function(){this.isShowCategory=!0},closeCategoryFunc(e){null!=e&&this.getFileCategory(),this.isShowCategory=!1},deleteCategoryFunc(e){t.confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteCategory(e)})).catch((()=>{a({type:"info",message:"已取消删除"})}))},deleteCategory(e){let t=this;c.deleteCategory({group_id:e}).then((e=>{a({message:"删除成功",type:"success"}),t.getFileCategory()})).catch((e=>{a.error("删除失败")}))},selectTypeFunc(e){this.activeType=e,this.curPage=1,this.getData()},handleCurrentChange(e){this.curPage=e,this.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData:function(){let e=this,t={page:e.curPage,pageSize:e.pageSize,group_id:e.activeType};c.fileList(t,!0).then((t=>{e.loading=!1,e.fileList=t.data.file_list,e.totalDataNumber=e.fileList.total})).catch((t=>{e.loading=!1}))},fileChange(e){},onBeforeUploadImage(e){const t="image/jpeg"===e.type||"image/jpg",i=e.size/1024/1024<1;return t||a.error("上传文件只能是图片格式!"),i||a.error("上传文件大小不能超过 1MB!"),t&&i},UploadImage(e){let t=this;const l=i.service({lock:!0,text:"图片上传中,请等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),s=new FormData;s.append("iFile",e.file),c.uploadFile(s).then((a=>{l.close(),t.getData(),e.onSuccess()})).catch((t=>{l.close(),a({message:"本次上传图片失败",type:"warning"}),e.onError()}))},selectFileFunc(e,t){if(e.selected)e.selected=!1,this.record--;else{if(this.record>=this.this_config.total)return void a({message:"本次最多只能上传 "+this.this_config.total+" 个文件",type:"warning"});e.selected=!0,this.record++}this.fileList.data[t]=e},deleteFileFunc(e){},confirmFunc(){let e=[];for(let t=0;t<this.fileList.data.length;t++){let a=this.fileList.data[t];if(a.selected){let t={file_id:a.file_id,file_path:a.file_path};e.push(t)}}this.$emit("returnImgs",e)},cancelFunc(){this.$emit("returnImgs",null)}}},D={class:"upload-wrap"},L={class:"upload-wrap-inline mb16 clearfix"},x={class:"leval-item"},T={class:"leval-item upload-btn"},I={class:"fileContainer"},P={class:"file-type"},U=["onClick"],V={key:0,class:"operation"},B=f("p",null,[f("i",{class:"el-icon-edit"})],-1),q=["onClickCapture"],A={class:"file-content"},N={class:"fileContainerUI clearfix"},W=["onClick"],E={key:0,class:"selectedIcon"},M=[f("i",{class:"el-icon-check"},null,-1)],$=["scr"],Q={class:"desc"},X={class:"bottom-shade"},Y={class:"pagination-wrap"},G={class:"dialog-footer"};const H=w(S,[["render",function(t,a,i,c,p,w){const S=l,H=s,J=d("Delete"),K=o,O=r,R=n,Z=e;return g(),u("div",D,[m(R,{title:"文件管理",modelValue:p.dialogVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>p.dialogVisible=e),"close-on-click-modal":!1,"custom-class":"upload-dialog","close-on-press-escape":!1,onClose:w.cancelFunc,width:p.dialogWidth},{footer:h((()=>[f("div",G,[m(S,{onClick:w.cancelFunc},{default:h((()=>[C("取 消")])),_:1},8,["onClick"]),m(S,{type:"primary",onClick:w.confirmFunc},{default:h((()=>[C("确 定")])),_:1},8,["onClick"])])])),default:h((()=>[f("div",L,[f("div",x,[m(S,{size:"small",icon:"Plus",onClick:w.addCategory},{default:h((()=>[C("添加分类")])),_:1},8,["onClick"])]),f("div",T,[m(H,{class:"avatar-uploader",multiple:"",ref:"upload",action:"string",accept:"image/jpeg,image/png,image/jpg","before-upload":w.onBeforeUploadImage,"http-request":w.UploadImage,"show-file-list":!1,"on-change":w.fileChange},{default:h((()=>[m(S,{size:"small",type:"primary"},{default:h((()=>[C("点击上传")])),_:1})])),_:1},8,["before-upload","http-request","on-change"])])]),f("div",I,[f("div",P,[f("ul",null,[(g(!0),u(y,null,j(p.typeList,((e,t)=>(g(),u("li",{class:_(p.activeType==e.group_id?"item active":"item"),key:t,onClick:t=>w.selectTypeFunc(e.group_id)},[C(v(e.group_name)+" ",1),null!=e.group_id?(g(),u("div",V,[B,f("p",{onClickCapture:F((t=>w.deleteCategoryFunc(e.group_id)),["stop"])},[m(K,null,{default:h((()=>[m(J)])),_:1})],40,q)])):k("",!0)],10,U)))),128))])]),f("div",A,[f("ul",N,[(g(!0),u(y,null,j(p.fileList.data,((e,t)=>(g(),u("li",{class:"file",key:t,onClick:a=>w.selectFileFunc(e,t)},[1==e.selected?(g(),u("div",E,M)):k("",!0),f("img",{scr:e.file_path,style:b("background-image:url("+e.file_path+")"),alt:""},null,12,$),f("p",Q,v(e.file_name),1),f("div",X,[m(K,{onClick:t=>w.deleteFileFunc(e)},{default:h((()=>[m(J)])),_:2},1032,["onClick"])])],8,W)))),128))])])]),f("div",Y,[m(O,{onSizeChange:w.handleSizeChange,onCurrentChange:w.handleCurrentChange,"current-page":p.curPage,"page-sizes":[12,24,36,42,48],"page-size":p.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:p.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),_:1},8,["modelValue","onClose","width"]),p.isShowCategory?(g(),z(Z,{key:0,onCloseCategory:w.closeCategoryFunc},null,8,["onCloseCategory"])):k("",!0)])}]]);export{H as default};
