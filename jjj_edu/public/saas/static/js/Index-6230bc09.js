import{a as e,c as a,d as l,r as o,p as t,s as i,b as r,e as d,i as s,f as p,k as n,t as m,v as u,j as c,u as h}from"./element-plus-1d2aab9a.js";import{r as f}from"./request-7e7ec6d1.js";import{_}from"./index-14a47fc3.js";import{o as g,S as b,R as w,a as V,O as x,V as y,ad as C,_ as v,c as D,X as k}from"./@vue-413ce838.js";import{d as j}from"./base-1c9aa973.js";import"./lodash-es-493ac664.js";import"./@vueuse-4fad2ccb.js";import"./dayjs-3f6c138b.js";import"./call-bind-a6dd5c06.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./@element-plus-1ce7f40b.js";import"./@popperjs-b78c3215.js";import"./escape-html-d3e23fdb.js";import"./normalize-wheel-es-3222b0a2.js";import"./@ctrl-91de2ec7.js";import"./axios-63583d02.js";import"./qs-edfbe083.js";import"./side-channel-6da5de8a.js";import"./object-inspect-66d569d0.js";import"./vue-router-569da8b3.js";import"./pinia-1c212f4d.js";let S={shopList:(e,a)=>f._post("/admin/shop/index",e,a),addShop:(e,a)=>f._post("/admin/shop/add",e,a),editShop:(e,a)=>f._post("/admin/shop/edit",e,a),updateStatus:(e,a)=>f._post("/admin/shop/updateStatus",e,a),storeEnter:(e,a)=>f._post("/admin/shop/enter",e,a),deleteShop:(e,a)=>f._post("/admin/shop/delete",e,a),updateWxStatus:(e,a)=>f._post("/admin/shop/updateWxStatus",e,a)};const E={data(){return{form:{no_expire:!1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l()},trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{this.form.password&&a!==this.form.password?l(new Error("确认密码不一致")):l()},trigger:"blur"}]}}},props:["open_edit","curModel"],created(){this.dialogVisible=this.open_edit,this.form=this.curModel},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.editShop(l,!0).then((l=>{a.loading=!1,e({message:"恭喜你，修改成功",type:"success"}),a.dialogFormVisible(!0)})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},U=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),z={class:"dialog-footer"};const L=_(E,[["render",function(e,p,n,m,u,c){const h=a,f=l,_=o,C=t,v=i,D=r,k=d,j=s;return g(),b(j,{title:"编辑平台",modelValue:u.dialogVisible,"onUpdate:modelValue":p[8]||(p[8]=e=>u.dialogVisible=e),onClose:c.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",z,[x(k,{onClick:c.dialogFormVisible},{default:w((()=>[y("取 消")])),_:1},8,["onClick"]),x(k,{type:"primary",onClick:p[7]||(p[7]=e=>c.addClick()),loading:u.loading},{default:w((()=>[y("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(D,{size:"small",model:u.form,ref:"form",rules:u.rules},{default:w((()=>[U,x(f,{label:"平台名称","label-width":u.formLabelWidth,prop:"app_name"},{default:w((()=>[x(h,{modelValue:u.form.app_name,"onUpdate:modelValue":p[0]||(p[0]=e=>u.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"过期时间","label-width":u.formLabelWidth,prop:"expire_time"},{default:w((()=>[x(_,{modelValue:u.form.expire_time_text,"onUpdate:modelValue":p[1]||(p[1]=e=>u.form.expire_time_text=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:u.form.no_expire},null,8,["modelValue","disabled"]),x(C,{modelValue:u.form.no_expire,"onUpdate:modelValue":p[2]||(p[2]=e=>u.form.no_expire=e),class:"pl16"},{default:w((()=>[y("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"平台账户名","label-width":u.formLabelWidth,prop:"user_name"},{default:w((()=>[x(h,{modelValue:u.form.user_name,"onUpdate:modelValue":p[3]||(p[3]=e=>u.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),x(v,{class:"gray"},{default:w((()=>[y("注：平台后台用户名")])),_:1})])),_:1},8,["label-width"]),x(f,{label:"平台账户密码","label-width":u.formLabelWidth,prop:"password"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password,"onUpdate:modelValue":p[4]||(p[4]=e=>u.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),x(v,{class:"gray"},{default:w((()=>[y("注：平台后台用户密码")])),_:1})])),_:1},8,["label-width"]),x(f,{label:"确认密码","label-width":u.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password_confirm,"onUpdate:modelValue":p[5]||(p[5]=e=>u.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"微信服务商支付","label-width":u.formLabelWidth,prop:"weixin_service"},{default:w((()=>[x(C,{modelValue:u.form.weixin_service,"onUpdate:modelValue":p[6]||(p[6]=e=>u.form.weixin_service=e)},{default:w((()=>[y("开启")])),_:1},8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]]),W={data(){return{form:{no_expire:!1,weixin_service:!1},formLabelWidth:"120px",dialogVisible:!1,loading:!1,rules:{app_name:[{validator:(e,a,l)=>a?this.$filter.isAllSpace(a)?l(new Error("不能全是空格")):void l():l(new Error("请输入平台名称")),required:!0,trigger:"blur"}],user_name:[{validator:(e,a,l)=>this.$filter.replaceSpace(a)?this.$filter.hasSpace(a)?l(new Error("不能包含空格")):void l():l(new Error("平台账户名")),required:!0,trigger:"blur"}],password:[{validator:(e,a,l)=>{if(a){if(this.$filter.hasSpace(a))return l(new Error("不能包含空格"));if(a.length<6)return l(new Error("长度不能小于6位"));l()}else l(new Error("请输入密码"))},required:!0,trigger:"change"}],password_confirm:[{validator:(e,a,l)=>{a?a!==this.form.password?l(new Error("确认密码不一致")):l():l(new Error("请填写确认密码"))},required:!0,trigger:"blur"}],expire_time:[{required:!0,trigger:"blur",message:"请选择过期时间"}]}}},props:["open_add"],created(){this.dialogVisible=this.open_add},methods:{addClick(){let a=this,l=this.form;a.$refs.form.validate((o=>{o&&(a.loading=!0,S.addShop(l,!0).then((l=>{a.loading=!1,1==l.code&&(e({message:"恭喜你，添加成功",type:"success"}),a.dialogFormVisible(!0))})).catch((e=>{a.loading=!1})))}))},dialogFormVisible(e){e?this.$emit("closeDialog",{type:"success",openDialog:!1}):this.$emit("closeDialog",{type:"error",openDialog:!1})}}},M=V("div",{style:{height:"0",overflow:"hidden"}},[V("input",{type:"password"})],-1),$={class:"dialog-footer"};const F={class:"common-level-rail"},q={class:"product-content"},Y={class:"table-wrap"},A={class:"pagination"};const P=_({components:{Edit:L,Add:_(W,[["render",function(e,p,n,m,u,c){const h=a,f=l,_=o,C=t,v=i,D=r,k=d,j=s;return g(),b(j,{title:"新增平台",modelValue:u.dialogVisible,"onUpdate:modelValue":p[7]||(p[7]=e=>u.dialogVisible=e),onClose:c.dialogFormVisible,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:w((()=>[V("div",$,[x(k,{onClick:c.dialogFormVisible},{default:w((()=>[y("取 消")])),_:1},8,["onClick"]),x(k,{type:"primary",onClick:p[6]||(p[6]=e=>c.addClick()),loading:u.loading},{default:w((()=>[y("确 定")])),_:1},8,["loading"])])])),default:w((()=>[x(D,{size:"small",model:u.form,ref:"form",rules:u.rules},{default:w((()=>[M,x(f,{label:"平台名称","label-width":u.formLabelWidth,prop:"app_name"},{default:w((()=>[x(h,{modelValue:u.form.app_name,"onUpdate:modelValue":p[0]||(p[0]=e=>u.form.app_name=e),autocomplete:"off",placeholder:"请输入平台名称"},null,8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"过期时间","label-width":u.formLabelWidth,prop:"expire_time",required:""},{default:w((()=>[x(_,{modelValue:u.form.expire_time,"onUpdate:modelValue":p[1]||(p[1]=e=>u.form.expire_time=e),type:"date",placeholder:"过期时间","value-format":"YYYY-MM-DD",disabled:u.form.no_expire},null,8,["modelValue","disabled"]),x(C,{modelValue:u.form.no_expire,"onUpdate:modelValue":p[2]||(p[2]=e=>u.form.no_expire=e),class:"pl16"},{default:w((()=>[y("永不过期")])),_:1},8,["modelValue"])])),_:1},8,["label-width"]),x(f,{label:"平台账户名","label-width":u.formLabelWidth,prop:"user_name"},{default:w((()=>[x(h,{modelValue:u.form.user_name,"onUpdate:modelValue":p[3]||(p[3]=e=>u.form.user_name=e),autocomplete:"off",placeholder:"请输入平台账户名"},null,8,["modelValue"]),x(v,{class:"gray"},{default:w((()=>[y("注：平台后台用户名")])),_:1})])),_:1},8,["label-width"]),x(f,{label:"平台账户密码","label-width":u.formLabelWidth,prop:"password"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password,"onUpdate:modelValue":p[4]||(p[4]=e=>u.form.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"]),x(v,{class:"gray"},{default:w((()=>[y("注：平台后台用户密码")])),_:1})])),_:1},8,["label-width"]),x(f,{label:"确认密码","label-width":u.formLabelWidth,prop:"password_confirm"},{default:w((()=>[x(h,{type:"password",modelValue:u.form.password_confirm,"onUpdate:modelValue":p[5]||(p[5]=e=>u.form.password_confirm=e),autocomplete:"off",placeholder:"请输入确认密码"},null,8,["modelValue"])])),_:1},8,["label-width"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"])}]])},data:()=>({loading:!0,tableData:[],pageSize:20,totalDataNumber:0,curPage:1,open_add:!1,open_edit:!1,curModel:{}}),created(){this.getData()},methods:{targetLinkAddress(){let e=window.location.hostname;return"https://".concat(e,"/admin/#/login")},handleCurrentChange(e){let a=this;a.page=e,a.loading=!0,a.getData()},handleSizeChange(e){this.curPage=1,this.pageSize=e,this.getData()},getData(){let e=this;S.shopList({page:e.curPage,list_rows:e.pageSize},!0).then((a=>{e.loading=!1,e.tableData=a.data.list.data,e.totalDataNumber=a.data.list.total,e.tableData.forEach((function(e){e.is_recycle=0===e.is_recycle,e.weixin_service=1===e.weixin_service}))})).catch((e=>{}))},addClick(){this.open_add=!0},editClick(e){this.open_edit=!0,this.curModel=j(e),0==this.curModel.expire_time?(this.curModel.expire_time_text="",this.curModel.no_expire=!0):this.curModel.no_expire=!1},closeDialogFunc(e,a){"add"==a&&(this.open_add=e.openDialog,"success"==e.type&&this.getData()),"edit"==a&&(this.open_edit=e.openDialog,"success"==e.type&&this.getData())},statusChange:function(e,a){let l=this;l.loading=!0,S.updateStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.is_recycle=e})).catch((o=>{l.loading=!1,a.is_recycle=!e}))},wxStatusChange:function(e,a){let l=this;l.loading=!0,S.updateWxStatus({app_id:a.app_id},!0).then((o=>{l.loading=!1,a.weixin_service=e})).catch((o=>{l.loading=!1,a.weixin_service=!e}))},deleteClick(a){let l=this;p.confirm("删除后不可恢复，确认删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{l.loading=!0,S.deleteShop({app_id:a.app_id},!0).then((a=>{l.loading=!1,1==a.code&&(e({message:a.msg,type:"success"}),l.getData())})).catch((e=>{l.loading=!1}))})).catch((()=>{}))},storeEnter(e){S.storeEnter({app_id:e},!0).then((e=>{})).catch((e=>{}))}}},[["render",function(e,a,l,o,i,r){const s=d,p=c,f=t,_=h,j=n,S=C("Add"),E=C("Edit"),U=m,z=u;return v((g(),D("div",null,[V("div",F,[x(s,{type:"primary",onClick:r.addClick},{default:w((()=>[y("添加平台")])),_:1},8,["onClick"])]),V("div",q,[V("div",Y,[V("div",null,[v((g(),b(j,{size:"small",data:i.tableData,style:{width:"100%"},"row-key":"access_id",border:"","default-expand-all":""},{default:w((()=>[x(p,{prop:"app_id",label:"平台ID"}),x(p,{prop:"app_name",label:"平台名称"}),x(p,{prop:"user_name",label:"超管账号"}),x(p,{prop:"is_recycle",label:"状态"},{default:w((e=>[x(f,{modelValue:e.row.is_recycle,"onUpdate:modelValue":a=>e.row.is_recycle=a,onChange:a=>r.statusChange(a,e.row)},{default:w((()=>[y("启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(p,{prop:"weixin_service",label:"微信服务商支付"},{default:w((e=>[x(f,{modelValue:e.row.weixin_service,"onUpdate:modelValue":a=>e.row.weixin_service=a,onChange:a=>r.wxStatusChange(a,e.row)},{default:w((()=>[y("启用")])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),x(p,{prop:"expire_time_text",label:"过期时间"}),x(p,{prop:"create_time",label:"添加时间"}),x(p,{label:"操作",width:"150"},{default:w((e=>[x(_,{href:r.targetLinkAddress(),target:"_blank",type:"primary",size:"small"},{default:w((()=>[y("进入平台")])),_:1},8,["href"]),x(_,{class:"ml10",onClick:a=>r.editClick(e.row),type:"text",size:"small"},{default:w((()=>[y("编辑")])),_:2},1032,["onClick"]),x(_,{class:"ml10",onClick:a=>r.deleteClick(e.row),type:"text",size:"small"},{default:w((()=>[y("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[z,i.loading]])])])]),i.open_add?(g(),b(S,{key:0,open_add:i.open_add,onCloseDialog:a[0]||(a[0]=e=>r.closeDialogFunc(e,"add"))},null,8,["open_add"])):k("",!0),i.open_edit?(g(),b(E,{key:1,open_edit:i.open_edit,curModel:i.curModel,onCloseDialog:a[1]||(a[1]=e=>r.closeDialogFunc(e,"edit"))},null,8,["open_edit","curModel"])):k("",!0),V("div",A,[x(U,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,background:"","current-page":i.curPage,"page-size":i.pageSize,layout:"total, prev, pager, next, jumper",total:i.totalDataNumber},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])),[[z,i.loading]])}]]);export{P as default};
